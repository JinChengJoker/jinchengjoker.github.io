import{_ as s,c as a,o as n,a as p}from"./app.d5b54cdf.js";const A=JSON.parse('{"title":"Ruby on rails \u4E4B\u5206\u9875","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u521B\u5EFA items Table","slug":"\u521B\u5EFA-items-table"},{"level":2,"title":"\u521B\u5EFA items Controller","slug":"\u521B\u5EFA-items-controller"},{"level":2,"title":"\u4F7F\u7528\u7B2C\u4E09\u65B9\u5E93\u8FDB\u884C\u5206\u9875","slug":"\u4F7F\u7528\u7B2C\u4E09\u65B9\u5E93\u8FDB\u884C\u5206\u9875"}],"relativePath":"blog/ruby/ruby_on_rails_04_pagination/index.md"}'),l={name:"blog/ruby/ruby_on_rails_04_pagination/index.md"},e=p(`<h1 id="ruby-on-rails-\u4E4B\u5206\u9875" tabindex="-1">Ruby on rails \u4E4B\u5206\u9875 <a class="header-anchor" href="#ruby-on-rails-\u4E4B\u5206\u9875" aria-hidden="true">#</a></h1><h2 id="\u521B\u5EFA-items-table" tabindex="-1">\u521B\u5EFA items Table <a class="header-anchor" href="#\u521B\u5EFA-items-table" aria-hidden="true">#</a></h2><p>\u6570\u636E\u5EFA\u6A21\uFF1A</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">bin/rails g model item user_id:bigint amount:integer note:text tags_id:bigint happend_at:datetime</span></span>
<span class="line"></span></code></pre></div><p>\u5B8C\u5584<code>db/migrate</code>\u4E2D\u5BF9\u5E94\u7684<code>change</code>\u65B9\u6CD5\uFF1A</p><div class="language-ruby"><button class="copy"></button><span class="lang">ruby</span><pre><code><span class="line"><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">change</span></span>
<span class="line"><span style="color:#A6ACCD;">  create_table </span><span style="color:#89DDFF;">:items</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">do</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">    t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bigint </span><span style="color:#89DDFF;">:user_id</span></span>
<span class="line"><span style="color:#A6ACCD;">    t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">integer </span><span style="color:#89DDFF;">:amount</span></span>
<span class="line"><span style="color:#A6ACCD;">    t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text </span><span style="color:#89DDFF;">:note</span></span>
<span class="line"><span style="color:#A6ACCD;">    t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bigint </span><span style="color:#89DDFF;">:tags_id,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">array:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">    t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">datetime </span><span style="color:#89DDFF;">:happend_at</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">timestamps</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">end</span></span>
<span class="line"><span style="color:#89DDFF;">end</span></span>
<span class="line"></span></code></pre></div><p>\u524D\u8FDB\u6570\u636E\u5E93\uFF1A</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">bin/rails db:migrate</span></span>
<span class="line"></span></code></pre></div><h2 id="\u521B\u5EFA-items-controller" tabindex="-1">\u521B\u5EFA items Controller <a class="header-anchor" href="#\u521B\u5EFA-items-controller" aria-hidden="true">#</a></h2><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">bin/rails g controller Api::V1::items</span></span>
<span class="line"></span></code></pre></div><p>\u6DFB\u52A0 items Controller \u7684<code>create</code>\u65B9\u6CD5\uFF1A</p><div class="language-ruby"><button class="copy"></button><span class="lang">ruby</span><pre><code><span class="line"><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">create</span></span>
<span class="line"><span style="color:#A6ACCD;">  item </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Item</span><span style="color:#89DDFF;">.</span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">amount:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> item</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">save</span></span>
<span class="line"><span style="color:#A6ACCD;">    render </span><span style="color:#89DDFF;">json:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{resource:</span><span style="color:#A6ACCD;"> item</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">else</span></span>
<span class="line"><span style="color:#A6ACCD;">    render </span><span style="color:#89DDFF;">json:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{errors:</span><span style="color:#A6ACCD;"> item</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errors</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">end</span></span>
<span class="line"><span style="color:#89DDFF;">end</span></span>
<span class="line"></span></code></pre></div><h2 id="\u4F7F\u7528\u7B2C\u4E09\u65B9\u5E93\u8FDB\u884C\u5206\u9875" tabindex="-1">\u4F7F\u7528\u7B2C\u4E09\u65B9\u5E93\u8FDB\u884C\u5206\u9875 <a class="header-anchor" href="#\u4F7F\u7528\u7B2C\u4E09\u65B9\u5E93\u8FDB\u884C\u5206\u9875" aria-hidden="true">#</a></h2><p>\u8FD9\u91CC\u63A8\u8350\u4E24\u4E2A\u7B2C\u4E09\u65B9\u5206\u9875\u5E93 <a href="https://github.com/kaminari/kaminari" target="_blank" rel="noreferrer">kaminari</a> \u548C <a href="https://github.com/ddnexus/pagy" target="_blank" rel="noreferrer">pagy</a>\u3002</p><p>\u5B89\u88C5<code>kaminari</code>\uFF0C\u5728<code>Gemfile</code>\u6587\u4EF6\u4E2D\u6DFB\u52A0\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">gem &#39;kaminari&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5B89\u88C5\u4F9D\u8D56\uFF1A</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">bundle</span></span>
<span class="line"><span style="color:#676E95;"># or</span></span>
<span class="line"><span style="color:#A6ACCD;">bundle install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># \u5F53\u4E0B\u8F7D\u592A\u6162\u65F6\uFF0C\u53EF\u4EE5\u67E5\u770B\u4E0B\u8F7D\u8FC7\u7A0B\u3001\u68C0\u67E5\u4E0B\u8F7D\u6E90</span></span>
<span class="line"><span style="color:#A6ACCD;">bundle --verbose</span></span>
<span class="line"></span></code></pre></div><p><em>\u5B89\u88C5\u5B8C\u6210\u540E\u53EF\u80FD\u9700\u8981\u91CD\u542F\u670D\u52A1\u3002</em></p><p>\u6DFB\u52A0 items Controller \u7684<code>index</code>\u65B9\u6CD5\uFF1A</p><div class="language-ruby"><button class="copy"></button><span class="lang">ruby</span><pre><code><span class="line"><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">index</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># \u83B7\u53D6\u7B2C\u4E00\u9875\u7684\u6570\u636E</span></span>
<span class="line"><span style="color:#A6ACCD;">  items </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Item</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">page</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  render </span><span style="color:#89DDFF;">json:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{resources:</span><span style="color:#A6ACCD;"> items</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">end</span></span>
<span class="line"></span></code></pre></div><p><code>kaminari</code>\u9ED8\u8BA4\u662F 25 \u6761\u6570\u636E\u4E3A\u4E00\u9875\uFF0C\u53EF\u4EE5\u5BF9\u5176\u8FDB\u884C\u914D\u7F6E\u3002</p><p>\u751F\u6210\u914D\u7F6E\u6587\u4EF6\uFF1A</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">bin/rails g kaminari:config</span></span>
<span class="line"></span></code></pre></div><p>\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6<code>kaminari_config.rb</code>\uFF1A</p><div class="language-ruby"><button class="copy"></button><span class="lang">ruby</span><pre><code><span class="line"><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">default_per_page </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span></span>
<span class="line"></span></code></pre></div><p>\u83B7\u53D6<code>page</code>\u53C2\u6570\uFF1A</p><div class="language-ruby"><button class="copy"></button><span class="lang">ruby</span><pre><code><span class="line"><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">index</span></span>
<span class="line"><span style="color:#A6ACCD;">  items </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Item</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">page</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">params</span><span style="color:#89DDFF;">[:page])</span></span>
<span class="line"><span style="color:#A6ACCD;">  render </span><span style="color:#89DDFF;">json:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{resources:</span><span style="color:#A6ACCD;"> items</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">end</span></span>
<span class="line"></span></code></pre></div><p>\u5355\u72EC\u6307\u5B9A\u6BCF\u9875\u7684\u6570\u91CF\uFF1A</p><div class="language-ruby"><button class="copy"></button><span class="lang">ruby</span><pre><code><span class="line"><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">index</span></span>
<span class="line"><span style="color:#A6ACCD;">  items </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Item</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">page</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">params</span><span style="color:#89DDFF;">[:page]).</span><span style="color:#A6ACCD;">per</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  render </span><span style="color:#89DDFF;">json:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{resources:</span><span style="color:#A6ACCD;"> items</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">end</span></span>
<span class="line"></span></code></pre></div><p>\u8FD4\u56DE\u5206\u9875\u4FE1\u606F\uFF1A</p><div class="language-ruby"><button class="copy"></button><span class="lang">ruby</span><pre><code><span class="line"><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">index</span></span>
<span class="line"><span style="color:#A6ACCD;">  items </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Item</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">page</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">params</span><span style="color:#89DDFF;">[:page]).</span><span style="color:#A6ACCD;">per</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  render </span><span style="color:#89DDFF;">json:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">resources:</span><span style="color:#A6ACCD;"> items</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">pager:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">page:</span><span style="color:#A6ACCD;"> params</span><span style="color:#89DDFF;">[:page],</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">per_page:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">count:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Item</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">count</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">end</span></span>
<span class="line"></span></code></pre></div>`,32),o=[e];function c(t,r,D,y,i,C){return n(),a("div",null,o)}const d=s(l,[["render",c]]);export{A as __pageData,d as default};
